// ==UserScript==
// @name         Darkify
// @version      0.4.5
// @description  Darken Any Website
// @run-at       document-end
// @author       erichsia7
// @inject-into  content
// @updateURL    https://erichsia7.github.io/darkify-extension/darkify-extension.user.js
// @downloadURL  https://erichsia7.github.io/darkify-extension/darkify-extension.user.js
// @match        *://*/*
// @noframes     
// @exclude      *://*.google.com/*
// @exclude      *://*.youtube.com/*
// @exclude      *://github.*/*
// ==/UserScript==
var darkify;(()=>{"use strict";var t={d:(n,r)=>{for(var e in r)t.o(r,e)&&!t.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:r[e]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)},n={};(()=>{function r(t){for(var n="",r="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",e=0;e<10;e++){var o=Math.round(62*Math.random());n+=r.substring(o,o+1)}return n=t+n}function e(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return o(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var e=0,a=function(){};return{s:a,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,d=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){d=!0,i=t},f:function(){try{c||null==r.return||r.return()}finally{if(d)throw i}}}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=Array(n);r<n;r++)e[r]=t[r];return e}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}t.d(n,{default:()=>q});var i=255,c=255,d=255,s=0;function l(t){return"object"!==a(t)||Array.isArray(t)?{type:"color",r:i,g:c,b:d}:{type:"color",r:t.hasOwnProperty("r")?t.r:i,g:t.hasOwnProperty("g")?t.g:c,b:t.hasOwnProperty("b")?t.b:d}}function f(t){return"object"!==a(t)||Array.isArray(t)?{type:"color",r:i,g:c,b:d,a:s}:{type:"color",r:t.hasOwnProperty("r")?t.r:i,g:t.hasOwnProperty("g")?t.g:c,b:t.hasOwnProperty("b")?t.b:d,a:t.hasOwnProperty("a")?t.a:s}}function u(t){var n,r,e=l(t),o=e.r/255,a=e.g/255,i=e.b/255,c=Math.max(o,a,i),d=Math.min(o,a,i),s=(c+d)/2;if(c===d)n=r=0;else{var f=c-d;switch(r=s>.5?f/(2-c-d):f/(c+d),c){case o:n=(a-i)/f+(a<i?6:0);break;case a:n=(i-o)/f+2;break;case i:n=(o-a)/f+4}n/=6}return{type:"color",h:n,s:r,l:s}}function m(t){var n=!1,r=u(t);if((r.s<=.38||r.l<=.23)&&(n=!0),n){var e=f(t),o=u({type:"color",r:255-e.r,g:255-e.g,b:255-e.b}),a=function(t){var n=t.h,r=t.s,e=t.l;if(0===r){var o=Math.round(255*e);return{type:"color",r:o,g:o,b:o}}var a=function(t,n,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(n-t)*r:r<1/3?n:r<.5?t+(n-t)*(2/3-r)*6:t},i=e<.5?e*(1+r):e+r-e*r,c=2*e-i,d=a(c,i,n+1/3),s=a(c,i,n),l=a(c,i,n-1/3);return{type:"color",r:Math.round(255*d),g:Math.round(255*s),b:Math.round(255*l)}}({type:"color",h:r.h,s:o.s,l:o.l});return{type:"color",r:a.r,g:a.g,b:a.b,a:e.a}}return t}function y(t,n){var r=getComputedStyle(t);function e(t){if(t.startsWith("var(")){var n=t.slice(4,-1).trim(),o=r.getPropertyValue(n).trim();return o.startsWith("var(")?e(o):o}return t}function o(t){var n=t.match(/rgba?\((\d+),\s{0,}(\d+),\s{0,}(\d+)(?:,\s{0,}(\d+\.?\d*))?\)/);if(!n)throw new Error("Invalid RGB/RGBA format: ".concat(t));return{type:"color",r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3]),a:n[4]?parseFloat(n[4]):1}}function a(t){return"transparent"===(t=e(t))?{type:"color",r:0,g:0,b:0,a:0}:t.startsWith("rgb")?o(t):t.startsWith("#")?function(t){var n,r,e;if(4===t.length)n=parseInt(t[1]+t[1],16),r=parseInt(t[2]+t[2],16),e=parseInt(t[3]+t[3],16);else{if(7!==t.length)throw new Error("Invalid hex format");n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),e=parseInt(t.slice(5,7),16)}return{type:"color",r:n,g:r,b:e,a:1}}(t):t.startsWith("linear-gradient")||t.startsWith("radial-gradient")||t.startsWith("conic-gradient")?function(t){var n;function r(t){var n=/(\d+(cm|mm|in|px|pt|px|em|ex|ch|rem|vw|vh|vmin|vmax|%))$/,r=[];return t.forEach((function(t){var e=t.trim().match(n);if(e){var o=a(t.trim().replace(n,"").trim()),i=e[0].trim();r.push({type:"color-stop",color:o,position:i})}})),r}if(n=t.match(/^linear-gradient\((.*)\)$/))return function(t){var n=t.match(/linear-gradient\((.*)\)/);if(!n||n.length<2)throw new Error("Invalid linear gradient string");var e=n[1].split(/,(?![^\(]*\))/);return{type:"linear-gradient",direction:e[0].trim().match(/^\d+deg$|^to /)?e.shift().trim():"to bottom",colorStops:r(e)}}(t);if(n=t.match(/^radial-gradient\((.*)\)$/))return function(t){var n={type:"radial-gradient",shape:"circle",size:"farthest-corner",position:"center",colorStops:[]},r=t.match(/radial-gradient\((.*)\)/i);if(!r)throw new Error("Invalid radial gradient string");var e=r[1].split(/,(?![^\(]*\))/),o=0,a=e[o].match(/^\s*(circle|ellipse|closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)?\s*(circle|ellipse|closest-side|farthest-side|closest-corner|farthest-corner|contain|cover)?\s*/i);a&&(n.shape=a[1]||null,n.size=a[2]||null,(a[1]||a[2])&&o++);var i=e[o].match(/^\s*at\s+([^\s,]+)\s+([^\s,]+)\s*/i);i&&(n.position="".concat(i[1]," ").concat(i[2]),o++);for(var c=o;c<e.length;c++){var d=e[c].trim();n.colorStops.push(d)}return n}(t);if(n=t.match(/^conic-gradient\((.*)\)$/))return function(t){var n=t[1].split(/,(.+)/);return{type:"conic-gradient",angle:n[0].trim(),colorStops:r(n[1])}}(n);throw new Error("Unsupported gradient format")}(t):t.startsWith("url")?{type:"color",r:i,g:c,b:d,a:s}:(n=t,(r=document.createElement("canvas").getContext("2d")).fillStyle=n,o(r.fillStyle));var n,r}return a(r.getPropertyValue(n).trim())}function p(t){for(var n={},r=0,e=["color","background-color","background-image","border-top-color","border-bottom-color","border-right-color","border-left-color","outline-color","text-decoration-color"];r<e.length;r++){var o=e[r];try{n[o]=y(t,o)}catch(t){continue}}return n}function g(t){var n={};for(var r in t){var e,o=t[r];switch(null===(e=o)||void 0===e?void 0:e.type){case"color":n[r]=m(o);break;case"linear-gradient":n[r]={type:"linear-gradient",direction:o.direction,colorStops:o.colorStops.map((function(t){return{type:"color-stop",color:m(t.color),position:t.position}}))};break;case"radial-gradient":n[r]={type:"radial-gradient",shapeAndSize:o.shapeAndSize,colorStops:o.colorStops.map((function(t){return{type:"color-stop",color:m(t.color),position:t.position}}))};break;case"conic-gradient":n[r]={type:"conic-gradient",angle:o.angle,colorStops:o.colorStops.map((function(t){return{type:"color-stop",color:m(t.color),position:t.position}}))};break;default:n[r]=o}}return n}function k(t,n){var r=[];for(var e in n){var o,a=n[e],i="";switch(null===(o=a)||void 0===o?void 0:o.type){case"color":i="rgba(".concat(a.r,", ").concat(a.g,", ").concat(a.b,", ").concat(a.a,")");break;case"linear-gradient":if(!(a.colorStops.length>=2))continue;var c=a.colorStops.map((function(t){return"rgba(".concat(t.color.r,", ").concat(t.color.g,", ").concat(t.color.b,", ").concat(t.color.a,") ").concat(t.position)})).join(", ");i="linear-gradient(".concat(a.direction,", ").concat(c,")");break;case"radial-gradient":if(!(a.colorStops.length>=2))continue;c=a.colorStops.map((function(t){return"rgba(".concat(t.color.r,", ").concat(t.color.g,", ").concat(t.color.b,", ").concat(t.color.a,") ").concat(t.position)})).join(", ");i="radial-gradient(".concat(a.shape," ").concat(a.size," at ").concat(a.position,", ").concat(c,")");break;default:continue}r.push("".concat(e,": ").concat(i," !important"))}return"".concat(t," {").concat(r.join(";"),"}")}const v='@keyframes transitioning-opacity {\n  0% {\n    opacity: 0;\n  }\n\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes filter-fade-out {\n  0% {\n    backdrop-filter: grayscale(1);\n    -webkit-backdrop-filter: grayscale(1);\n  }\n\n  100% {\n    backdrop-filter: grayscale(0);\n    -webkit-backdrop-filter: grayscale(0);\n  }\n}\n\n.darkify_transition_mask {\n  width: 43px;\n  height: 43px;\n  position: fixed;\n  bottom: 12px;\n  left: 12px;\n  border-radius: 100%;\n  background-color: var(--darkify-transparent);\n  z-index: 999;\n  user-select: none;\n  -webkit-user-select: none;\n  opacity: 0;\n  outline: none;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  transform: scale(1);\n  backdrop-filter: invert(1) grayscale(1);\n  -webkit-backdrop-filter: invert(1) grayscale(1);\n}\n\n.darkify_transition_mask.darkify_transitioning {\n  animation-duration: var(--darkify-duration);\n  animation-name: transitioning-opacity, transitioning-zoom;\n  animation-fill-mode: forwards;\n  animation-timing-function: var(--darkify-timing-function);\n  animation-direction: normal;\n}\n\n.darkify_ending_mask {\n  position: fixed;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  z-index: 1000;\n  user-select: none;\n  -webkit-user-select: none;\n  display: none;\n  outline: none;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  backdrop-filter: grayscale(1);\n  -webkit-backdrop-filter: grayscale(1);\n}\n\n.darkify_ending_mask.darkify_displayed {\n  display: block;\n  opacity: 1;\n}\n\n.darkify_ending_mask.darkify_filter_fade_out {\n  animation-duration: var(--darkify-duration-2);\n  animation-name: filter-fade-out;\n  animation-fill-mode: forwards;\n  animation-timing-function: ease-out;\n}\n\n.darkify_button {\n  width: 43px;\n  height: 43px;\n  position: fixed;\n  bottom: 12px;\n  left: 12px;\n  border-radius: 100%;\n  z-index: 1001;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  user-select: none;\n  -webkit-user-select: none;\n  transition: background-color var(--darkify-duration);\n  transition-timing-function: var(--darkify-timing-function);\n  outline: none;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  box-shadow: 0px 0px 15px -5px rgba(0, 0, 0, 0.1);\n}\n\n.darkify_button svg {\n  position: absolute;\n  top: 10px;\n  left: 10px;\n  width: 23px;\n  height: 23px;\n  user-select: none;\n  -webkit-user-select: none;\n  transition: opacity var(--darkify-duration);\n  transition-timing-function: var(--darkify-timing-function);\n}\n\n.darkify_button svg path {\n  transition: fill var(--darkify-duration);\n  transition-timing-function: var(--darkify-timing-function);\n}\n\n.darkify_button[dark-mode="true"] {\n  background-color: var(--darkify-333333);\n}\n\n.darkify_button[dark-mode="true"] svg path {\n  fill: var(--darkify-ffffff);\n}\n\n.darkify_button[dark-mode="true"] svg[mode="light"] {\n  opacity: 0;\n}\n\n.darkify_button[dark-mode="true"] svg[mode="dark"] {\n  opacity: 1;\n}\n\n.darkify_button[dark-mode="false"] {\n  background-color: var(--darkify-ffffff);\n}\n\n.darkify_button[dark-mode="false"] svg path {\n  fill: var(--darkify-333333);\n}\n\n.darkify_button[dark-mode="false"] svg[mode="light"] {\n  opacity: 1;\n}\n\n.darkify_button[dark-mode="false"] svg[mode="dark"] {\n  opacity: 0;\n}',h=":root {\n  --darkify-ffffff: #ffffff;\n  --darkify-333333: #333333;\n  --darkify-transparent: rgba(0, 0, 0, 0);\n  --darkify-timing-function: cubic-bezier(0.77, 0, 0.175, 1);\n  --darkify-duration: 750ms;\n  --darkify-duration-2: 500ms;\n}";function b(){var t=document.createElement("div");t.classList.add("darkify_button"),t.setAttribute("dark-mode","false"),t.setAttribute("darkifying","false"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" mode="light"><path d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 60q-74.92 0-127.46-52.54Q300-405.08 300-480q0-74.92 52.54-127.46Q405.08-660 480-660q74.92 0 127.46 52.54Q660-554.92 660-480q0 74.92-52.54 127.46Q554.92-300 480-300ZM80-450q-12.75 0-21.37-8.63Q50-467.26 50-480.01q0-12.76 8.63-21.37Q67.25-510 80-510h90q12.75 0 21.38 8.63 8.62 8.63 8.62 21.38 0 12.76-8.62 21.37Q182.75-450 170-450H80Zm710 0q-12.75 0-21.38-8.63-8.62-8.63-8.62-21.38 0-12.76 8.62-21.37Q777.25-510 790-510h90q12.75 0 21.37 8.63 8.63 8.63 8.63 21.38 0 12.76-8.63 21.37Q892.75-450 880-450h-90ZM479.99-760q-12.76 0-21.37-8.62Q450-777.25 450-790v-90q0-12.75 8.63-21.37 8.63-8.63 21.38-8.63 12.76 0 21.37 8.63Q510-892.75 510-880v90q0 12.75-8.63 21.38-8.63 8.62-21.38 8.62Zm0 710q-12.76 0-21.37-8.63Q450-67.25 450-80v-90q0-12.75 8.63-21.38 8.63-8.62 21.38-8.62 12.76 0 21.37 8.62Q510-182.75 510-170v90q0 12.75-8.63 21.37Q492.74-50 479.99-50ZM240.23-678.38l-50.31-48.93q-8.92-8.31-8.61-20.88.31-12.58 8.73-21.89 9.19-9.3 21.58-9.3 12.38 0 21.07 9.3L282-720.15q8.69 9.3 8.69 21.07t-8.5 21.08q-8.5 9.31-20.57 8.81-12.08-.5-21.39-9.19Zm487.08 488.46L678-239.85q-8.69-9.3-8.69-21.38 0-12.08 8.69-20.77 8.12-9.31 20.29-8.81t21.48 9.19l50.31 48.93q8.92 8.31 8.61 20.88-.31 12.58-8.73 21.89-9.19 9.3-21.58 9.3-12.38 0-21.07-9.3ZM678-677.81q-9.31-8.5-8.81-20.57.5-12.08 9.19-21.39l48.93-50.31q8.31-8.92 20.88-8.61 12.58.31 21.89 8.73 9.3 9.19 9.3 21.58 0 12.38-9.3 21.07L720.15-678q-9.3 8.69-21.07 8.69t-21.08-8.5ZM189.92-189.84q-9.3-9.39-9.3-21.78 0-12.38 9.3-21.07L239.85-282q9.3-8.69 21.38-8.69 12.08 0 20.77 8.69 8.92 8.12 8.42 20.29t-8.8 21.48l-48.93 50.31q-8.69 9.3-21.07 9-12.39-.31-21.7-8.92ZM480-480Z"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" mode="dark"><path d="M481.15-140Q339-140 240.08-238.92 141.16-337.85 141.16-480q0-118.38 73.26-210.46 73.27-92.08 195.19-118.69 12.62-3.16 22.23.61 9.62 3.77 15.62 11.23 6 7.47 7.08 18.12 1.07 10.65-5 21.27-12.39 22.54-18.39 46.83t-6 51.09q0 98.33 68.84 167.17Q562.82-424 661.15-424q29.47 0 56.31-7.46 26.85-7.46 47-17.31 9.85-4.3 19.23-3.04 9.39 1.27 16.02 6.27 7.37 5 10.94 13.66 3.58 8.65.81 20.34-21.31 118-114.81 194.77Q603.15-140 481.15-140Zm0-60q88 0 158-48.5t102-126.5q-20 5-40 8t-40 3q-123 0-209.5-86.5T365.15-660q0-20 3-40t8-40q-78 32-126.5 102t-48.5 158q0 116 82 198t198 82Zm-10-270Z"/></svg> ',t.addEventListener("click",(function(t){t.preventDefault(),function(){var t=document.querySelector(".darkify_button"),n=t.getAttribute("dark-mode"),o=t.getAttribute("darkifying");"false"===o&&("false"===n?(t.setAttribute("dark-mode","true"),function(){var t=r("d_"),n=document.querySelector(".darkify_button");n.setAttribute("darkifying","true");var o=document.createElement("style");o.id="".concat(t,"_keyframes"),o.innerHTML=_(),document.documentElement.appendChild(o);var a=function(){var t,n=[],o=e(document.querySelectorAll("body *,body"));try{for(o.s();!(t=o.n()).done;){var a=t.value,i=r("");a.setAttribute("darkify-extension",i);var c=g(p(a));n.push(k("".concat(String(a.tagName).toLowerCase(),'[darkify-extension="').concat(i,'"]'),c))}}catch(t){o.e(t)}finally{o.f()}return n.join("")}(),i=document.querySelector(".darkify_ending_mask"),c=document.querySelector(".darkify_transition_mask");c.classList.add("darkify_transitioning"),c.addEventListener("animationend",(function(r){var e=document.querySelector("style#".concat(t,"_keyframes"));null!==e&&e.remove(),c.classList.remove("darkify_transitioning"),i.classList.add("darkify_displayed"),document.querySelector("style.dark_mode_style_loader").innerHTML=a,setTimeout((function(){i.classList.add("darkify_filter_fade_out")}),1),i.addEventListener("animationend",(function(t){i.classList.remove("darkify_displayed"),i.classList.remove("darkify_filter_fade_out"),n.setAttribute("darkifying","false")}),{once:!0})}),{once:!0})}()):"true"===n&&(t.setAttribute("dark-mode","false"),function(){var t=r("d_"),n=document.querySelector(".darkify_button");n.setAttribute("darkifying","true");var e=document.createElement("style");e.id="".concat(t,"_keyframes"),e.innerHTML=_(),document.documentElement.appendChild(e);var o=document.querySelector(".darkify_ending_mask"),a=document.querySelector(".darkify_transition_mask");a.classList.add("darkify_transitioning"),a.addEventListener("animationend",(function(r){var e=document.querySelector("style#".concat(t,"_keyframes"));null!==e&&e.remove(),a.classList.remove("darkify_transitioning"),o.classList.add("darkify_displayed"),document.querySelector("style.dark_mode_style_loader").innerHTML="",setTimeout((function(){o.classList.add("darkify_filter_fade_out")}),1),o.addEventListener("animationend",(function(t){o.classList.remove("darkify_displayed"),o.classList.remove("darkify_filter_fade_out"),n.setAttribute("darkifying","false")}),{once:!0})}),{once:!0})}()))}()})),document.documentElement.appendChild(t)}function _(){var t=window.innerWidth,n=21.5,r=window.innerHeight-33.5,e=t+100,o=Math.sqrt(Math.pow(e-33.5,2)+Math.pow(-100-r,2))/n;return"@keyframes transitioning-zoom { 0% {transform: scale(1);} 100% {transform: scale(".concat(o,");}}")}var w={initialize:function(){!function(){var t=document.createElement("style");t.innerHTML=h,document.documentElement.appendChild(t);var n=document.createElement("style");n.innerHTML=v,document.documentElement.appendChild(n);var r=document.createElement("style");r.classList.add("dark_mode_style_loader"),document.documentElement.appendChild(r)}(),b(),function(){var t=document.createElement("div");t.classList.add("darkify_transition_mask"),document.documentElement.appendChild(t);var n=document.createElement("div");n.classList.add("darkify_ending_mask"),document.documentElement.appendChild(n)}()}};w.initialize();const q=w})(),darkify=n.default})();